<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="generator" content="GitLab Pages">
  <title>Weekly Blog - Greybus for Zephyr Updates</title>
  <link rel="stylesheet" href="style.css">
  <link rel=”alternate” type="application/rss+xml" href="https://gsoc.beagleboard.io/greybus-for-zephyr/feed.xml"
    title="Weekly Blog - Greybus for Zephyr Updates">
</head>

<body>
  <div class="navbar">
    <a href="https://pages.gitlab.io/plain-html/">Plain HTML Example</a>
    <a href="https://git.beagleboard.org/gsoc/greybus-for-zephyr/">Repository</a>
    <a href="https://gitlab.com/pages/">Other Examples</a>
    <a href="https://git.beagleboard.org/gsoc/greybus-for-zephyr/feed.xml">RSS</a>
  </div>

  <h1>Weekly Progress Report: Greybus for Zephyr</h1>

  <p>
    Hi, this is a weekly blog for my GSoC 2022 project
    <a href="https://elinux.org/BeagleBoard/GSoC/2022_Proposal/GreybusforZephyrUpdates">Greybus for Zephyr Updates</a>.
    My mentors for this project are Jason Kridner, Vaishnav Achath, Deepak Khatri and Tim Orlington.
    This thread will be updated weekly.
  </p>

  <img src="workspace.jpg" style="float:right;width:600px;height:400px;">

  <div class="week_updates">
    <h2>Week 1</h2>
    <h4>Accomplishments</h4>
    <p>
    <ul>
      <li>Build Zephyr applications for BeagleConnect nodes on the Gateway device.</li>
      <li>Fixes for the updated bcf-sdk <a href="https://github.com/jadonk/zephyr/pull/17">[Pull #17]</a></li>
      <li>Setup connection between the native POSIX target and host</li>
    </ul>
    </p>

    <h4>Blockers</h4>
    <p>
    <ul>
      <li><a href="https://git.beagleboard.org/gsoc/greybus-for-zephyr/-/issues/2">Greybus cannot bind I2C device</a>
      </li>
      <li><a
          href="https://git.beagleboard.org/gsoc/greybus-for-zephyr/-/issues/3">https://git.beagleboard.org/gsoc/greybus-for-zephyr/-/issues/3</a>
      </li>
    </ul>
    </p>

    <h4>Upcoming Targets</h4>
    <p>
    <ul>
      <li>Finish the introduction video</li>
      <li>Establish a TCP connection between the native POSIX target and host</li>
    </ul>
    </p>
  </div>

  <div class="week_updates">
    <h2>Week 2</h2>
    <h4>Accomplishments</h4>
    <p>
    <ul>
      <li>Finished the introduction slides and scripts</li>
      <li>Patched the issue causing stack smashing on the native_POSIX target <a
          href="https://git.beagleboard.org/gsoc/greybus-for-zephyr/-/commit/9fd1f60da38f0f3476428232cf90043b96abd64e">[Commit
          9fd1f60d]</a></li>
      <li>Setup a greybus application on the native_POSIX target communicating via UART <a
          href="https://git.beagleboard.org/gsoc/greybus-for-zephyr/-/commit/34fdf30596ed7325dd53aedea7f8e11fd03645e5">[Commit
          34fdf305]</a> </li>
    </ul>
    </p>

    <h4>Blockers</h4>
    <p>
    <ul>
      <li><a href="https://git.beagleboard.org/gsoc/greybus-for-zephyr/-/issues/2">Greybus cannot bind I2C device</a>
      </li>
      <li><a href="https://git.beagleboard.org/gsoc/greybus-for-zephyr/-/issues/3">A kernel panic happens if a network
          interface connected to the POSIX target is setup.</a>
      </li>
    </ul>
    </p>

    <h4>Upcoming Targets</h4>
    <p>
    <ul>
      <li>Interface PWM with zephyr from nuttx sources</li>
      <li>Establish a TCP connection between the native POSIX target and host</li>
    </ul>
    </p>
  </div>

  <div class="week_updates">
    <h2>Week 3</h2>
    <h4>Accomplishments</h4>
    <p>
    <ul>
      <li>Finished the introduction video <a href="https://youtu.be/GN82Yiq_kRg">YouTube</a></li>
      <li>Fix for demo in BeagleConnect documentation <a href="https://github.com/jadonk/beagleconnect/pull/93">[PR
          #93]</a></li>
      <li>Fix CI to build an test greybus applications <a href="">[Commit 775e85db]</a> </li>
      <li>Interface PWM from nuttx sources <a
          href="https://git.beagleboard.org/gsoc/greybus-for-zephyr/-/tree/pwm-wip">[Branch pwm-wip]</a></li>
    </ul>
    </p>

    <h4>Blockers</h4>
    <p>
    <ul>
      <li><a href="https://git.beagleboard.org/gsoc/greybus-for-zephyr/-/issues/2">Greybus cannot bind I2C device</a>
      </li>
      <li><a href="https://git.beagleboard.org/gsoc/greybus-for-zephyr/-/issues/3">A kernel panic happens if a network
          interface connected to the POSIX target is setup.</a>
      </li>
      <li><a href="https://git.beagleboard.org/gsoc/greybus-for-zephyr/-/pipelines/370">Cannot build greybus on CI</a>
      </li>
    </ul>
    </p>

    <h4>Upcoming Targets</h4>
    <p>
    <ul>
      <li>Test PWM over greybus</li>
      <li>Improve the testbench</li>
      <li>Interface PWM with zephyr from nuttx sources</li>
    </ul>
    </p>
  </div>

  <div class="week_updates">
    <h2>Week 4</h2>
    <h4>Accomplishments</h4>
    <p>
    <ul>
      <li>Reorganize the code so it's easier to track. </li>
      <li>Started developing a host side testbench to generate greybus message instead of gbridge</li>
      <li>Interface UART from nuttx sources <a
          href="https://git.beagleboard.org/gsoc/greybus/greybus-for-zephyr/-/tree/uart-wip">[Branch uart-wip]</a></li>
    </ul>
    </p>

    <h4>Blockers</h4>
    <p>
    <ul>
      <li>Inconsistent behaviour by the greybus-pwm firmware (crashes the host sometimes)</li>
      <li>Zephyr does not have api to generate UART break</li>
    </ul>
    </p>

    <h4>Upcoming Targets</h4>
    <p>
    <ul>
      <li>Test PWM and UART over greybus</li>
      <li>Improve the testbench</li>
      <li>Interface GPIO IRQ with zephyr from nuttx sources</li>
    </ul>
    </p>
  </div>

  <div class="week_updates">
    <h2>Week 5</h2>
    <h4>Accomplishments</h4>
    <p>
    <ul>
      <li>Fix CI, again...</li>
      <li>Started developing a host side testbench to generate greybus message instead of gbridge</li>
      <li>Complete port of UART from nuttx sources <a
          href="https://git.beagleboard.org/gsoc/greybus/greybus-for-zephyr/-/tree/uart-wip">[Branch uart-wip]</a></li>
    </ul>
    </p>

    <h4>Blockers</h4>
    <p>
    <ul>
      <li>
        <a href="https://git.beagleboard.org/gsoc/greybus-for-zephyr/-/issues/5">
          UART and PWM firmware cause USAGE FAULTS on zephyr and occasionally hang the host</a>
      </li>
      <li>The "userspace gbridge" does not connect to the POSIX target</li>
    </ul>
    </p>

    <h4>Upcoming Targets</h4>
    <p>
    <ul>
      <li>Test PWM and UART peripherals over greybus</li>
      <li>Connect to the POSIX target with a userspace testbench</li>
    </ul>
    </p>
  </div>

  <div class="week_updates">
    <h2>Week 6</h2>
    <h4>Accomplishments</h4>
    <p>
    <ul>
      <li>Completed beagleconnect documentation for docs.beagleboard.io <a
          href="https://git.beagleboard.org/docs/docs.beagleboard.io/-/merge_requests/14">[Merge #14]</a>
      </li>
      <li>I thought an incorrect devicetree overlay was causing <a
          href="https://git.beagleboard.org/gsoc/greybus-for-zephyr/-/issues/5"> Issue #5</a>, as the error is caused by
        passing a pointer to a non-static local variable to a state machine which changed the value at that memory
        location later on. However, this does not seem to fix the issue.</li>
      <li>Greybus core messages are being sent to the POSIX target</li>
    </ul>
    </p>

    <h4>Blockers</h4>
    <p>
    <ul>
      <li><a href="https://git.beagleboard.org/gsoc/greybus-for-zephyr/-/issues/5">
          This issue now shows up even when PWM or UART are not configured.</a> I am a little lost on how to debug this
        issue.
      </li>
      <li>POSIX target does not receive the messages over the pseudo-terminal. I am unsure about how the interfaces in
        gbridge work, upon figuring them out, I should be able to write
        greybus messages to a pseudo-terminal </li>
    </ul>
    </p>

    <h4>Upcoming Targets</h4>
    <p>
    <ul>
      <li>Move the PWM and UART devices into the gb_bundle's private data</li>
      <li>Get core greybus messages working on the testbench</li>
    </ul>
    </p>
  </div>

  <div class="week_updates">
    <h2>Week 7</h2>
    <h4>Accomplishments</h4>
    <p>
    <ul>
      <li>Narrowed down the cause of the major blocker <a
          href="https://git.beagleboard.org/gsoc/greybus-for-zephyr/-/issues/5">[Issue #5]</a></li>
    </ul>
    </p>

    <h4>Blockers</h4>
    <p>
    <ul>
      <li><a href="https://git.beagleboard.org/gsoc/greybus-for-zephyr/-/issues/5">
          This issue now shows up even when PWM or UART are not configured.</a> This seems to have risen from the recent
        rebase of zephyr to version 3.1.0. My understanding so far is that the zephyr target crashes when gbridge is run
        on the host. The kernel panic on the host probably occurs because of the errors on the zephyr side of things.
        The doubly-linked list seems to cause an imprecise bus error when initialized. This leads me to some sort of
        regression in the transport-tcpip.c.
      </li>
      <li>POSIX target does not receive the messages over the pseudo-terminal. I am unsure about how the interfaces in
        gbridge work, upon figuring them out, I should be able to write
        greybus messages to a pseudo-terminal </li>
    </ul>
    </p>

    <h4>Upcoming Targets</h4>
    <p>
    <ul>
      <li>Thoroughly debug the transport-tcpip to figure out what has regressed</li>
      <li>Get core greybus messages working on the testbench</li>
    </ul>
    </p>
  </div>

</body>

</html>